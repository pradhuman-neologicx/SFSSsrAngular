<div class="container-fluid mb-4">
  <div class="d-md-flex justify-content-between align-items-center">
    <h1 class="text-primary table-heading-detail">Test Master</h1>
    <div>
      <button
        (click)="openCreateModal()"
        class="btn btn-custom-primary px-4 py-2 mb-md-0 mb-2"
      >
        Create Test
      </button>
    </div>
  </div>

  <div class="card border-0 mb-4 px-4 py-4">
    <div class="d-md-flex justify-content-between align-items-center my-3">
      <div class="d-flex align-items-center mb-md-0 mb-2">
        <span class="me-1 show-entery-text">Show</span>
        <select
          class="form-control form-select show-entries-select"
          (change)="onTableSizeChange($event)"
        >
          <option *ngFor="let size of tableSizes" [ngValue]="size">
            {{ size }}
          </option>
        </select>
        <span class="ms-1 show-entery-text">entries</span>
      </div>

      <div class="d-flex align-items-center">
        <form [formGroup]="searchbarform" class="d-flex align-items-center">
          <span class="me-1">Search:</span>
          <div
            [ngClass]="{'table-card table': searchbarform.controls['searchbar'].errors?.['required'] && (searchbarform.controls['searchbar'].touched || searchbarform.controls['searchbar'].dirty)}"
          >
            <input
              type="text"
              class="form-control search-user position-relative"
              autocomplete="off"
              formControlName="searchbar"
              [ngClass]="{
                'is-invalid':
                  searchbarform.controls['searchbar'].errors &&
                  (searchbarform.controls['searchbar'].touched ||
                    searchbarform.controls['searchbar'].dirty)
              }"
            />
            <div
              class="text-danger error-message d-block"
              *ngIf="
                searchbarform.controls['searchbar'].errors &&
                (searchbarform.controls['searchbar'].touched ||
                  searchbarform.controls['searchbar'].dirty)
              "
            >
              <p
                class="fw-light text-danger search-required"
                *ngIf="searchbarform.controls['searchbar'].errors['required']"
              >
                This is required
              </p>
            </div>
          </div>
          <button class="btn btn-primary search-btn ms-2" (click)="searchfun()">
            <span
              ><i class="fa-solid fa-magnifying-glass form-control-feedback"></i
            ></span>
          </button>
          <button
            class="btn btn-primary search-btn ms-2"
            (click)="resetsearchbar()"
            type="submit"
            *ngIf="showreset == true"
          >
            <span
              ><i class="fa-solid fa-rotate-right form-control-feedback"></i
            ></span>
          </button>
        </form>
      </div>
    </div>
    <div class="table-responsive-sm">
      <table class="table table-bordered table-hover table-striped mb-0">
        <thead class="table-header">
          <tr *ngFor="let detail of table_heading">
            <th>
              <p class="table-heading">{{ detail.heading0 }}</p>
            </th>
            <th>
              <p class="table-heading">{{ detail.heading1 }}</p>
            </th>
            <th>
              <p class="table-heading">{{ detail.heading2 }}</p>
            </th>
            <th>
              <p class="table-heading">{{ detail.heading3 }}</p>
            </th>
            <th>
              <p class="table-heading">{{ detail.heading6 }}</p>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let test of testList
                | paginate
                  : {
                      itemsPerPage:
                        tableSize != 'all' ? tableSize : totalRecords,
                      currentPage: page,
                      totalItems: totalRecords
                    };
              index as i
            "
          >
            <td>{{ i + 1 }}</td>
            <td>
              <p>{{ test.testName }}</p>
            </td>
            <td>
              <p>{{ test.testType }}</p>
            </td>
            <td>
              <p>{{ test.testMethod }}</p>
            </td>
            <td>
              <p>
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="openEditModal(test)">
                    Edit
                  </button>
                  <button mat-menu-item (click)="openViewModal(test)">
                    View Details
                  </button>
                </mat-menu>
              </p>
            </td>
          </tr>
        </tbody>
      </table>
      <div
        class="d-md-flex justify-content-between bottom-0 end-0 py-2 align-items-center"
      >
        <span class="showalltext"
          >Showing
          {{ tableSize * (page - 1) > 0 ? tableSize * (page - 1) + 1 : 1 }} to
          {{
            tableSize * page <= totalRecords ? tableSize * page : totalRecords
          }}
          of {{ totalRecords != undefined ? totalRecords : "" }} entries</span
        >
        <pagination-controls
          previousLabel="Prev"
          nextLabel="Next"
          [responsive]="true"
          (pageChange)="onTableDataChange($event)"
          target="_top"
        ></pagination-controls>
      </div>
    </div>
  </div>
</div>

<!-- Create Test Modal -->
<div
  *ngIf="testCreateOpen"
  class="your-animation-class modal-container"
  aria-labelledby="modal-Test"
  role="package"
  aria-modal="true"
>
  <div class="modal-content modal-content-50" [@fadeIn]>
    <div (click)="clickModalContent($event)">
      <form [formGroup]="testCreateForm">
        <div class="card">
          <div
            class="card-header bg-white d-flex justify-content-between align-items-center"
          >
            <h5 class="modal-title pt-1">Create Test</h5>
            <button
              class="btn btn-primary main-btn bg-transparent border-0 pb-0 pt-1 text-black"
              type="button"
              (click)="closeModal()"
            >
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          <div class="modal-content-width card-body mb-0 pb-0">
            <div class="row">
              <div class="col-lg-6 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_name"
                  >Test Name</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_name"
                  placeholder="C C Cubes"
                  [ngClass]="{
                    'is-invalid':
                      testCreateForm.controls['test_name'].errors &&
                      (testCreateForm.controls['test_name'].touched ||
                        testCreateForm.controls['test_name'].dirty)
                  }"
                />
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testCreateForm.controls['test_name'].errors &&
                    (testCreateForm.controls['test_name'].touched ||
                      testCreateForm.controls['test_name'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testCreateForm.controls['test_name'].errors['required']
                    "
                  >
                    Test name is required
                  </p>
                </div>
              </div>
              <div class="col-lg-6 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_type"
                  >Test Type</label
                >
                <select
                  class="d-block form-select form-control form-input-custom"
                  formControlName="test_type"
                  [ngClass]="{
                    'is-invalid':
                      testCreateForm.controls['test_type'].errors &&
                      (testCreateForm.controls['test_type'].touched ||
                        testCreateForm.controls['test_type'].dirty)
                  }"
                >
                  <option value="Material Based Test" selected disabled>
                    Material Based Test
                  </option>
                  <option value="Material Based Test">
                    Material Based Test
                  </option>
                  <option value="Field Based Test">Field Based Test</option>
                </select>
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testCreateForm.controls['test_type'].errors &&
                    (testCreateForm.controls['test_type'].touched ||
                      testCreateForm.controls['test_type'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testCreateForm.controls['test_type'].errors['required']
                    "
                  >
                    Test type is required
                  </p>
                </div>
              </div>
              <div class="col-lg-6 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_method"
                  >Test Method</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_method"
                  placeholder="IS:561-P1-2021"
                  [ngClass]="{
                    'is-invalid':
                      testCreateForm.controls['test_method'].errors &&
                      (testCreateForm.controls['test_method'].touched ||
                        testCreateForm.controls['test_method'].dirty)
                  }"
                />
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testCreateForm.controls['test_method'].errors &&
                    (testCreateForm.controls['test_method'].touched ||
                      testCreateForm.controls['test_method'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testCreateForm.controls['test_method'].errors['required']
                    "
                  >
                    Test method is required
                  </p>
                </div>
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  >Input Fields</label
                >
                <div formArrayName="input_fields">
                  <div
                    *ngFor="let field of inputFields.controls; let i = index"
                    [formGroupName]="i"
                    class="d-flex align-items-center mb-2"
                  >
                    <input
                      type="text"
                      class="form-control form-input-custom me-2"
                      formControlName="input_field"
                      placeholder=" Compressive Strength"
                      [ngClass]="{
                        'is-invalid':
                          field.get('input_field')?.errors &&
                          (field.get('input_field')?.touched ||
                            field.get('input_field')?.dirty)
                      }"
                    />
                    <div
                      class="text-danger error-message"
                      *ngIf="
                        field.get('input_field')?.errors &&
                        (field.get('input_field')?.touched ||
                          field.get('input_field')?.dirty)
                      "
                    >
                      <p
                        class="fw-light text-danger"
                        *ngIf="field.get('input_field')?.errors?.['required']"
                      >
                        Input field is required
                      </p>
                    </div>
                    <button
                      class="btn btn-danger btn-sm"
                      type="button"
                      (click)="removeInputField(i)"
                    >
                      Remove
                    </button>
                  </div>
                </div>
                <button
                  class="btn btn-primary btn-sm mt-2"
                  type="button"
                  (click)="addInputField()"
                >
                  Add Input Field
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer text-end me-4 mb-3">
            <button
              class="btn btn-secondary main-btnfs px-4 py-2 me-4 text-gray-100"
              type="button"
              (click)="closeModal()"
            >
              Cancel
            </button>
            <button
              class="btn btn-custom-primary px-4 py-2"
              type="submit"
              (click)="createTest()"
            >
              Create
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Update Test Modal -->
<div
  *ngIf="testUpdateOpen"
  class="your-animation-class modal-container"
  aria-labelledby="modal-Test"
  role="dialog"
  aria-modal="true"
>
  <div class="modal-content modal-content-50" [@fadeIn]>
    <div (click)="clickModalContent($event)">
      <form [formGroup]="testUpdateForm">
        <div class="card">
          <div
            class="card-header bg-white d-flex justify-content-between align-items-center"
          >
            <h5 class="modal-title pt-1">Update Test</h5>
            <button
              class="btn btn-primary main-btn bg-transparent border-0 pb-0 pt-1 text-black"
              type="button"
              (click)="closeModal()"
            >
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          <div class="modal-content-width card-body mb-0 pb-0">
            <div class="row">
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_name"
                  >Test Name</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_name"
                  [ngClass]="{
                    'is-invalid':
                      testUpdateForm.controls['test_name'].errors &&
                      (testUpdateForm.controls['test_name'].touched ||
                        testUpdateForm.controls['test_name'].dirty)
                  }"
                />
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testUpdateForm.controls['test_name'].errors &&
                    (testUpdateForm.controls['test_name'].touched ||
                      testUpdateForm.controls['test_name'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testUpdateForm.controls['test_name'].errors['required']
                    "
                  >
                    Test name is required
                  </p>
                </div>
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_type"
                  >Test Type</label
                >
                <select
                  class="d-block form-select form-control form-input-custom"
                  formControlName="test_type"
                  [ngClass]="{
                    'is-invalid':
                      testUpdateForm.controls['test_type'].errors &&
                      (testUpdateForm.controls['test_type'].touched ||
                        testUpdateForm.controls['test_type'].dirty)
                  }"
                >
                  <option value="Material Test">Material Test</option>
                  <option value="Field Test">Field Test</option>
                </select>
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testUpdateForm.controls['test_type'].errors &&
                    (testUpdateForm.controls['test_type'].touched ||
                      testUpdateForm.controls['test_type'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testUpdateForm.controls['test_type'].errors['required']
                    "
                  >
                    Test type is required
                  </p>
                </div>
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_method"
                  >Test Method</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_method"
                  [ngClass]="{
                    'is-invalid':
                      testUpdateForm.controls['test_method'].errors &&
                      (testUpdateForm.controls['test_method'].touched ||
                        testUpdateForm.controls['test_method'].dirty)
                  }"
                />
                <div
                  class="text-danger error-message"
                  *ngIf="
                    testUpdateForm.controls['test_method'].errors &&
                    (testUpdateForm.controls['test_method'].touched ||
                      testUpdateForm.controls['test_method'].dirty)
                  "
                >
                  <p
                    class="fw-light text-danger"
                    *ngIf="
                      testUpdateForm.controls['test_method'].errors['required']
                    "
                  >
                    Test method is required
                  </p>
                </div>
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  >Input Fields</label
                >
                <div formArrayName="input_fields">
                  <div
                    *ngFor="
                      let field of updateInputFields.controls;
                      let i = index
                    "
                    [formGroupName]="i"
                    class="d-flex align-items-center mb-2"
                  >
                    <input
                      type="text"
                      class="form-control form-input-custom me-2"
                      formControlName="input_field"
                      placeholder="Input Field"
                      [ngClass]="{
                        'is-invalid':
                          field.get('input_field')?.errors &&
                          (field.get('input_field')?.touched ||
                            field.get('input_field')?.dirty)
                      }"
                    />
                    <div
                      class="text-danger error-message"
                      *ngIf="
                        field.get('input_field')?.errors &&
                        (field.get('input_field')?.touched ||
                          field.get('input_field')?.dirty)
                      "
                    >
                      <p
                        class="fw-light text-danger"
                        *ngIf="field.get('input_field')?.errors?.['required']"
                      >
                        Input field is required
                      </p>
                    </div>
                    <button
                      class="btn btn-danger btn-sm"
                      type="button"
                      (click)="removeUpdateInputField(i)"
                    >
                      Remove
                    </button>
                  </div>
                </div>
                <button
                  class="btn btn-primary btn-sm mt-2"
                  type="button"
                  (click)="addUpdateInputField()"
                >
                  Add Input Field
                </button>
              </div>
            </div>
          </div>
          <div class="modal-footer text-end me-4 mb-3">
            <button
              class="btn btn-secondary main-btnfs px-4 py-2 me-4 text-gray-100"
              type="button"
              (click)="closeModal()"
            >
              Cancel
            </button>
            <button
              class="btn btn-custom-primary px-4 py-2"
              type="submit"
              (click)="updateTest()"
            >
              Update
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View Test Modal -->
<div
  *ngIf="testViewOpen"
  class="your-animation-class modal-container"
  aria-labelledby="modal-Test"
  role="dialog"
  aria-modal="true"
>
  <div class="modal-content modal-content-50" [@fadeIn]>
    <div (click)="clickModalContent($event)">
      <form [formGroup]="testViewForm">
        <div class="card">
          <div
            class="card-header bg-white d-flex justify-content-between align-items-center"
          >
            <h5 class="modal-title pt-1">View Test</h5>
            <button
              class="btn btn-primary main-btn bg-transparent border-0 pb-0 pt-1 text-black"
              type="button"
              (click)="closeModal()"
            >
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          <div class="modal-content-width card-body mb-0 pb-0">
            <div class="row">
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_name"
                  >Test Name</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_name"
                  [readOnly]="true"
                />
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_type"
                  >Test Type</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_type"
                  [readOnly]="true"
                />
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  for="test_method"
                  >Test Method</label
                >
                <input
                  type="text"
                  class="d-block form-control form-input-custom"
                  formControlName="test_method"
                  [readOnly]="true"
                />
              </div>
              <div class="col-lg-12 col-md-12 mb-3">
                <label
                  class="d-block text-capitalize form-label admin-form-lable"
                  >Input Fields</label
                >
                <div formArrayName="input_fields">
                  <div
                    *ngFor="
                      let field of viewInputFields.controls;
                      let i = index
                    "
                    [formGroupName]="i"
                    class="mb-2"
                  >
                    <input
                      type="text"
                      class="form-control form-input-custom"
                      formControlName="input_field"
                      [readOnly]="true"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer text-end mb-4 me-4">
            <button
              class="btn btn-secondary main-btnfs px-4 py-2 text-gray-100"
              type="button"
              (click)="closeModal()"
            >
              Cancel
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<div
  *ngIf="openSuccessMessage"
  class="your-animation-class modal-container-success"
  [@slideIn]
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div>
    <div
      class="p-4 d-flex justify-content-between align-items-center success-content"
    >
      <span class="icon-success me-2"><i class="fa-solid fa-check"></i></span>
      <p class="text-green-900 text-capitalize mb-0">
        {{ successMessage }} successfully
      </p>
    </div>
  </div>
</div>
